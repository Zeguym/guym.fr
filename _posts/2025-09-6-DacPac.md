---
title: DAC-PAC (Data-tier Application Component Package)
tags: SQLServer dacpac database
---

Un **DacPac** est un fichier compressé avec l’extension `.dacpac` utilisé pour déployer, gérer et versionner des bases de données SQL Server ou Azure SQL Database. Il encapsule la définition complète du schéma de la base de données (tables, vues, procédures stockées, fonctions, types, etc.) sous forme de métadonnées XML, ainsi que des informations sur les objets dépendants.

<!--more-->

# Qu'est-ce qu'un DacPac ?

## Structure détaillée d’un fichier DacPac

Un fichier `.dacpac` est en réalité une archive ZIP contenant plusieurs fichiers structurés :

- **model.xml** : le cœur du DacPac, ce fichier XML décrit l’ensemble du schéma de la base de données (objets, propriétés, relations).
- **Origin.xml** : informations sur l’origine du DacPac (nom du projet, version, auteur).
- **Scripts de pré-déploiement et post-déploiement** : fichiers `.sql` optionnels permettant d’exécuter des scripts avant ou après le déploiement du schéma.
- **Références** : fichiers décrivant les dépendances vers d’autres bases ou packages.
- **Dossiers de métadonnées** : contiennent des informations additionnelles sur la version, la compatibilité, etc.

## Utilisations principales

- **Déploiement initial** : Création d’une nouvelle base de données à partir du modèle contenu dans le DacPac.
- **Mise à jour (upgrade)** : Comparaison du schéma du DacPac avec une base existante et génération automatique des scripts de migration nécessaires.
- **Contrôle de version** : Stockage du DacPac dans un système de gestion de code source pour suivre l’évolution du schéma.
- **Automatisation DevOps** : Intégration dans des pipelines CI/CD pour automatiser les déploiements et les tests de schéma.

## Création et utilisation

- **Création** :
  - Via Visual Studio ou SQL Server Data Tools (SSDT) en publiant un projet de base de données.
  - Avec la commande `sqlpackage /Action:Extract` pour extraire un DacPac d’une base existante.
- **Déploiement** :
  - Avec SQL Server Management Studio (SSMS) via l’assistant d’importation de DacPac.
  - En ligne de commande avec `sqlpackage /Action:Publish`.
  - Intégration dans des pipelines CI/CD pour automatiser les déploiements.

## Avantages

- **Automatisation** : Facilite le déploiement et la mise à jour des bases de données sans intervention manuelle.
- **Sécurité** : Réduit les risques d’erreurs humaines lors des modifications de schéma.
- **Traçabilité** : Permet de versionner précisément l’état du schéma à chaque étape du développement.
- **Portabilité** : Simplifie la migration entre environnements (développement, test, production).
- **Comparaison de schémas** : Outils intégrés pour comparer et synchroniser les différences entre le DacPac et une base cible.

## Limites

- **Pas de données** : Un DacPac ne contient que le schéma, pas les données de la base.
- **Opérations complexes** : Certaines transformations majeures ou manipulations de données nécessitent des scripts personnalisés.
- **Compatibilité** : Certaines fonctionnalités spécifiques à une version de SQL Server peuvent ne pas être entièrement supportées.

## Exemple de workflow complet

1. Développer le schéma dans un projet SSDT (Visual Studio).
2. Générer un DacPac à chaque version stable du schéma.
3. Stocker le DacPac dans le contrôle de source (Git, Azure DevOps, etc.).
4. Déployer ou mettre à jour les bases de données cibles via le DacPac, manuellement ou dans un pipeline CI/CD.
5. Utiliser les outils de comparaison pour valider les différences avant déploiement.

## DacPac et SSDT

**SQL Server Data Tools (SSDT)** est l’environnement de développement intégré dans Visual Studio pour la conception, le développement et la gestion des bases de données SQL Server. SSDT permet de :

- Créer des projets de base de données, gérer le schéma sous forme de code source et générer facilement des fichiers DacPac.
- Modéliser la base de données sous forme de projet, facilitant la gestion du schéma dans un système de contrôle de version.
- Générer un DacPac à partir d’un projet SSDT pour déployer ou mettre à jour des bases de données.
- Comparer des schémas et automatiser le déploiement via DacPac, intégrés à Visual Studio et aux pipelines DevOps.

**Résumé** : SSDT est l’outil principal pour créer, gérer et exploiter les DacPac dans un cycle de vie de développement de base de données, en assurant cohérence, traçabilité et automatisation des déploiements.
